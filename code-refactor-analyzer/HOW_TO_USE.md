# Code Refactor Analyzer - 使用指南

## 概述

代码重构分析技能帮助开发者根据新需求识别需要重构的代码，生成可操作的待办事项列表，并跟踪完成进度。

## 核心功能

### 1. 需求分析
- 理解用户需求并识别可能的代码影响
- 分析需求的关键词和上下文

### 2. 代码影响分析
- 分析仓库找到可能受需求影响的代码行
- 识别需要修改的函数、类和模块

### 3. 待办事项报告生成
- 创建结构化的待办事项列表
- 包含具体的代码位置和任务描述

### 4. 完成情况验证
- 检查之前生成的待办事项完成状态
- 提供完成度报告

### 5. 状态管理
- 自动检测首次使用（生成报告）或后续使用（检查完成情况）
- 相同需求下，首次使用生成报告，后续使用检查完成情况

## 使用方法

### 首次使用（生成报告）

当您首次提出重构需求时，技能会分析代码库并生成待办事项报告。

**示例**：
```
@code-refactor-analyzer

分析代码库，为添加用户认证功能识别需要重构的代码
```

**输出**：
- 待办事项报告文件：`.claude/code_refactor_report/添加用户认证功能-2025-12-14.md`
- 报告包含：需要修改的代码位置、具体任务、优先级建议

### 后续使用（检查完成情况）

当您再次提出相同或类似需求时，技能会检查之前生成的报告并验证完成情况。

**示例**：
```
@code-refactor-analyzer

检查昨天关于用户认证重构的待办事项完成情况
```

**输出**：
- 完成度报告：显示已完成、进行中和未开始的任务
- 进度百分比
- 下一步建议

### 更多使用场景

#### 代码迁移
```
@code-refactor-analyzer

为从类组件迁移到函数组件生成重构计划
```

#### 功能添加
```
@code-refactor-analyzer

分析添加支付处理功能需要修改的代码
```

#### 性能优化
```
@code-refactor-analyzer

识别性能瓶颈并生成优化待办事项
```

## 报告格式

### 报告文件位置
```
.claude/code_refactor_report/[用户需求]-[日期].md
```

### 报告内容结构
```
# 重构需求：[用户需求]
# 生成日期：[日期]
# 状态：[待处理/进行中/已完成]

## 待办事项列表

### 高优先级
- [ ] [文件路径]:[行号] - [任务描述]
  - 原因：[为什么需要修改]
  - 建议：[修改建议]

### 中优先级
- [ ] [文件路径]:[行号] - [任务描述]
  - 原因：[为什么需要修改]
  - 建议：[修改建议]

### 低优先级
- [ ] [文件路径]:[行号] - [任务描述]
  - 原因：[为什么需要修改]
  - 建议：[修改建议]

## 进度跟踪
- 总任务数：[数字]
- 已完成：[数字]
- 进行中：[数字]
- 未开始：[数字]
- 完成率：[百分比]%
```

## 最佳实践

### 1. 明确需求
- 提供具体、详细的需求描述
- 包含业务背景和技术约束
- 明确优先级和截止时间

### 2. 代码库准备
- 确保Claude可以访问代码库
- 打开相关项目或仓库
- 提供必要的上下文信息

### 3. 增量重构
- 从小范围开始，逐步扩展
- 优先处理高优先级任务
- 定期检查完成情况

### 4. 文档记录
- 在重构代码中添加注释
- 更新相关文档
- 记录重构决策和原因

## 限制和注意事项

### 技术限制
- 需要Claude能够访问代码库文件
- 分析基于代码模式，可能无法捕获所有边缘情况
- 不能自动修复代码 - 仅提供指导建议
- 在结构良好的代码库中效果最佳

### 使用建议
- 对于复杂重构场景，可能需要人工审核
- 建议分阶段实施重构计划
- 定期使用完成检查功能跟踪进度
- 结合团队代码审查流程

## 故障排除

### 常见问题

#### 1. 技能找不到代码库
- 确保已打开相关项目或仓库
- 检查Claude是否有文件访问权限
- 确认当前工作目录正确

#### 2. 报告未生成
- 检查`.claude/code_refactor_report/`目录是否存在
- 确认有写入权限
- 检查需求描述是否明确

#### 3. 完成检查不准确
- 确保使用相同的需求描述
- 检查报告文件是否被修改
- 确认日期格式匹配

#### 4. 分析结果不理想
- 提供更详细的需求描述
- 指定具体的文件或模块
- 添加技术约束和边界条件

## 高级用法

### 自定义优先级
在需求描述中指定优先级：
```
@code-refactor-analyzer

分析代码库，为API响应时间优化生成重构计划，高优先级
```

### 指定文件范围
限制分析范围：
```
@code-refactor-analyzer

分析src/api/目录下的代码，为添加缓存功能生成重构计划
```

### 时间约束
添加时间限制：
```
@code-refactor-analyzer

为数据库查询优化生成一周内可完成的重构计划
```

## 更新日志

### v1.0.0 (2025-12-14)
- 初始版本发布
- 支持需求分析和代码影响分析
- 实现待办事项报告生成
- 添加完成情况验证功能
- 实现智能状态管理

## 支持

如有问题或建议，请：
1. 检查本使用指南
2. 验证代码库访问权限
3. 提供具体的错误信息和上下文
4. 联系技能维护者