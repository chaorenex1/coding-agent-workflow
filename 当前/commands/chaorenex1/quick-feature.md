# 快速功能实现工作流

## 用法
`/quick-feature <FEATURE_DESCRIPTION> [OPTIONS]`

### 参数
- `<FEATURE_DESCRIPTION>`：功能需求描述（支持中英文）
- `[OPTIONS]`：可选参数
  - `--skip-tests`：跳过测试阶段
  - `--skip-review`：跳过代码审查（不推荐）
  - `--minimal-docs`：生成最简化文档
  - `--scope <PATH>`：指定实施范围（默认：整个项目）

## 上下文
- 待实现功能：$ARGUMENTS
- 针对中小型功能需求的快速开发流程
- 自动识别仓库架构并复用现有组件
- 智能体协作保证代码质量与架构一致性

## 你的角色
你是快速开发协调者，管理精简的智能体团队高效完成功能开发：

1. **架构识别专家** – 扫描仓库识别架构模式与技术栈
2. **需求分析师** – 快速分析需求并定义验收标准
3. **开发工程师** – 实施功能并确保代码质量
4. **质量保障员** – 可选测试与验证

## 工作流程

### 阶段0：仓库架构识别（自动执行）

**目标**：快速理解项目结构与技术栈

```
使用架构识别专家智能体：
"扫描当前仓库并提取关键架构信息

## 扫描任务：
1. **项目类型识别**：
   - 前端/后端/全栈/库/工具
   - Web应用/API服务/桌面应用/CLI工具

2. **技术栈检测**：
   - 主要编程语言与版本
   - 核心框架与库
   - 构建工具与包管理器

3. **代码组织模式**：
   - 目录结构约定（src/lib/app/components/等）
   - 命名规范（kebab-case/camelCase/PascalCase）
   - 模块划分与分层结构

4. **现有组件扫描**：
   - 可复用的工具函数/组件/服务
   - 通用的数据模型/接口定义
   - 已有的设计模式应用

5. **开发约定识别**：
   - 代码风格配置（ESLint/Prettier/等）
   - 测试框架与测试位置
   - 文档规范（JSDoc/TypeDoc/等）

## 输出格式：
生成快速参考摘要（保存为 ./.claude/quick-context.md）：
- 项目类型与技术栈
- 核心目录结构
- 关键复用组件列表
- 代码风格要点
- 功能实施建议位置

预计耗时：30-60秒"
```

**质量标准**：
- ✅ 识别出主要编程语言与框架
- ✅ 提取至少3个关键目录路径
- ✅ 找到至少2个可复用组件
- ✅ 明确代码风格约定

---

### 阶段1：需求快速分析（交互式）

**目标**：5分钟内明确功能边界与验收标准

#### 1.1 智能需求解析

```
使用需求分析师智能体：
"分析功能需求并生成精简PRD

输入需求：[$ARGUMENTS]
仓库上下文：[来自阶段0的架构信息]

## 分析要点：
1. **核心功能**：用1-2句话描述主要功能
2. **用户故事**：生成2-3个关键用户故事
3. **验收标准**：明确3-5条可验证的标准
4. **技术约束**：基于现有架构的限制
5. **影响范围**：需修改/新增的文件预估

## 快速质量检查：
- 需求是否明确？（清晰度评分 1-10）
- 是否有歧义点？（列出需澄清的部分）
- 预估复杂度？（简单/中等/复杂）

如果清晰度 < 7，生成3个澄清问题并等待用户回复
如果清晰度 >= 7，直接生成PRD摘要"
```

#### 1.2 交互式澄清（如需要）

当清晰度不足时，向用户提问：
- 问题1：[具体澄清点]
- 问题2：[具体澄清点]
- 问题3：[具体澄清点]

等待用户回复后更新PRD。

#### 1.3 PRD确认

当PRD清晰度 ≥ 7分时，展示给用户：

```
📋 功能需求摘要

核心功能：[一句话描述]

用户故事：
- 作为[角色]，我想[功能]，以便[目标]
- [更多故事]

验收标准：
✓ [标准1]
✓ [标准2]
✓ [标准3]

预估复杂度：[简单/中等/复杂]
预计文件数：[约X个文件]

是否开始实施？(yes/no)
```

**等待用户确认**，如果用户回复 "yes/是/确认/开始"，进入阶段2。

---

### 阶段2：技术方案设计（快速通道）

**目标**：10分钟内完成技术方案

```
使用架构识别专家智能体（复用）：
"基于PRD生成快速技术方案

PRD路径：[如果已保存]
仓库架构：[来自阶段0]
功能需求：[$ARGUMENTS]

## 设计要点：
1. **文件规划**：
   - 需要新建的文件（路径+职责）
   - 需要修改的文件（路径+改动类型）
   - 文件命名遵循现有约定

2. **组件设计**：
   - 主要类/函数/组件（名称+接口）
   - 复用现有组件的方式
   - 新增抽象（如需要）

3. **数据流设计**：
   - 输入输出定义
   - 关键数据结构
   - 与现有系统的集成点

4. **实施顺序**：
   - 按依赖关系排序的实施步骤
   - 每步的预估时间

## 输出格式：
生成技术方案摘要（保存为 ./.claude/specs/{feature-name}/tech-design.md）：
- 文件清单（新建/修改）
- 核心接口定义
- 实施步骤（1-5步）
- 风险点（如有）

快速通道限制：
- 方案说明 ≤ 500字
- 实施步骤 ≤ 5步
- 不生成详细架构图（除非复杂度为'复杂'）"
```

#### 2.1 方案快速审核

展示技术方案摘要给用户：

```
🏗️ 技术方案摘要

文件操作：
📝 新建：[文件1], [文件2]
✏️ 修改：[文件3], [文件4]

核心接口：
- [接口1名称]：[一句话说明]
- [接口2名称]：[一句话说明]

实施步骤：
1. [步骤1]（预估：X分钟）
2. [步骤2]（预估：X分钟）
...

风险提示：[如有]

是否批准方案并开始开发？(yes/no)
```

**等待用户确认**，如果用户回复 "yes/是/批准/开始"，进入阶段3。

---

### 阶段3：功能实施（自动执行）

**目标**：按技术方案完成代码实现

```
使用开发工程师智能体：
"实施功能并确保代码质量

技术方案路径：./.claude/specs/{feature-name}/tech-design.md
PRD路径：./.claude/specs/{feature-name}/requirements.md
仓库架构：./.claude/quick-context.md

## 实施要求：
1. **代码质量**：
   - 遵循仓库的代码风格约定
   - 添加必要的注释与文档
   - 使用类型标注（如适用）
   - 处理边界情况与错误

2. **架构一致性**：
   - 遵循现有目录结构
   - 复用现有组件与工具函数
   - 保持命名规范一致
   - 遵循现有设计模式

3. **渐进式开发**：
   - 按技术方案的步骤顺序实施
   - 每完成一个步骤报告进度
   - 遇到问题及时说明并请求指导

4. **自测要求**：
   - 手动验证核心功能
   - 确保不破坏现有功能
   - 检查边界情况

## 实施步骤：
[按技术方案的步骤执行]

## 进度报告格式：
每完成一个步骤后报告：
✅ 步骤X完成：[步骤描述]
   - 新建文件：[文件路径]
   - 修改文件：[文件路径]
   - 关键改动：[简要说明]
   - 下一步：[下个步骤]"
```

**实时进度展示**：
```
🚀 开发进度

✅ 步骤1：创建基础接口定义
   📝 src/types/feature.ts
✅ 步骤2：实现核心逻辑
   📝 src/services/feature-service.ts
⏳ 步骤3：集成到现有系统（进行中...）
⬜ 步骤4：添加错误处理
⬜ 步骤5：编写文档
```

---

### 阶段4：质量验证（可选 - 默认执行）

**跳过条件**：用户指定 `--skip-tests`

#### 4.1 代码审查（除非 --skip-review）

```
使用代码审查智能体（如存在）：
"审查新实现的代码

实施文件：[从阶段3获取]
PRD路径：./.claude/specs/{feature-name}/requirements.md
技术方案路径：./.claude/specs/{feature-name}/tech-design.md

## 审查要点：
1. **功能完整性**：是否满足所有验收标准
2. **代码质量**：可读性、可维护性、性能
3. **架构一致性**：是否遵循现有模式
4. **潜在问题**：边界情况、错误处理、安全性

## 输出格式：
- 审查结果：通过/有风险/不通过
- 问题清单（如有）：[问题描述 + 建议修复]
- 优化建议（可选）：[改进方向]

快速通道限制：
- 仅标记关键问题（不要求完美）
- 优化建议 ≤ 3条"
```

如果审查不通过，返回阶段3进行修复。

#### 4.2 测试验证（除非 --skip-tests）

```
使用质量保障员智能体：
"验证功能是否符合验收标准

实施文件：[从阶段3获取]
PRD路径：./.claude/specs/{feature-name}/requirements.md
验收标准：[从PRD提取]

## 验证任务：
1. **功能测试**：
   - 验证每个验收标准
   - 测试正常流程
   - 测试边界情况

2. **集成测试**：
   - 与现有功能的兼容性
   - 不影响现有功能

3. **测试报告**：
   - 验收标准检查清单
   - 发现的问题（如有）
   - 测试结论（通过/未通过）

快速通道限制：
- 不要求编写自动化测试（除非项目已有测试框架）
- 手动功能测试即可
- 测试报告 ≤ 200字"
```

**展示测试报告**：
```
✅ 测试报告

验收标准检查：
✓ [标准1] - 通过
✓ [标准2] - 通过
✓ [标准3] - 通过

集成测试：
✓ 不影响现有功能
✓ 与[组件X]正常集成

发现的问题：
- [问题描述]（严重度：低/中/高）

测试结论：通过 ✅
```

如果测试未通过，返回阶段3进行修复。

---

### 阶段5：交付与文档（自动执行）

**目标**：完成功能交付并生成必要文档

#### 5.1 生成文档（根据 --minimal-docs）

**标准文档**（默认）：
```
生成以下文档：
1. 功能说明：./.claude/specs/{feature-name}/README.md
   - 功能描述
   - 使用方法
   - API文档（如适用）
   - 配置说明（如适用）

2. 变更记录：./.claude/specs/{feature-name}/CHANGELOG.md
   - 新增文件列表
   - 修改文件列表
   - 关键改动说明

3. 代码内文档：
   - 关键函数的JSDoc/注释
   - 接口/类型的说明
```

**最简文档**（--minimal-docs）：
```
仅生成：
1. 快速说明：./.claude/specs/{feature-name}/QUICKSTART.md
   - 功能一句话描述
   - 使用示例（1-2个）
   - 新增的关键文件路径
```

#### 5.2 交付摘要

生成完成报告：

```
🎉 功能实施完成

📋 功能名称：[功能名]
⏱️ 总耗时：[预估时间]
📊 复杂度：[简单/中等/复杂]

📁 文件变更：
新建：
  - [文件1]（[行数] 行）
  - [文件2]（[行数] 行）
修改：
  - [文件3]（[改动行数] 行）

✅ 验收标准：全部通过 (X/X)

📚 文档位置：
  - 功能说明：./.claude/specs/{feature-name}/README.md
  - 技术方案：./.claude/specs/{feature-name}/tech-design.md
  - 变更记录：./.claude/specs/{feature-name}/CHANGELOG.md

🚀 后续建议：
- [建议1]
- [建议2]
```

---

## 时间预估

| 阶段 | 标准耗时 | 快速通道耗时 |
|------|---------|------------|
| 阶段0：仓库扫描 | 1-2分钟 | 30-60秒 |
| 阶段1：需求分析 | 5-10分钟 | 3-5分钟 |
| 阶段2：技术方案 | 10-15分钟 | 5-10分钟 |
| 阶段3：功能实施 | 根据复杂度 | 根据复杂度 |
| 阶段4：质量验证 | 10-15分钟 | 5分钟（可跳过） |
| 阶段5：交付文档 | 5分钟 | 2分钟 |

**总计**：
- 简单功能：20-30分钟
- 中等功能：40-60分钟
- 复杂功能：建议使用完整的 `/bmad-pilot` 流程

---

## 关键特性

### 🚀 快速通道优化

1. **精简文档**：
   - 避免冗长的架构文档
   - 专注核心技术决策
   - 摘要式输出

2. **并行分析**：
   - 仓库扫描与需求分析可并行
   - 技术方案与代码审查可复用智能体

3. **智能跳过**：
   - 简单功能自动采用快速通道
   - 复杂功能自动建议使用完整流程

### 🎯 用户控制点

**2个必须确认点**（不可跳过）：
1. ✋ PRD确认：明确需求后才开始实施
2. ✋ 方案确认：批准技术方案后才编码

**1个可选确认点**：
- ⚙️ 测试验证：可通过 `--skip-tests` 跳过

### 🔍 架构感知

- 自动识别项目类型与技术栈
- 复用现有组件与模式
- 遵循既定代码规范
- 智能推荐文件位置

### 📊 质量保障

- 需求清晰度评分（≥7分才实施）
- 代码审查（可选跳过）
- 验收标准检查
- 集成测试

---

## 使用场景

### 适用场景 ✅

- **小型功能**：新增工具函数、辅助类、UI组件
- **功能增强**：在现有模块上扩展功能
- **Bug修复后的功能补充**：修复后增加防御性代码
- **快速原型**：验证技术可行性
- **维护性任务**：重构、优化、文档补充

### 不适用场景 ❌

- **大型功能**：涉及多个模块、复杂交互（建议用 `/bmad-pilot`）
- **架构变更**：需要重大架构调整的需求
- **跨团队协作**：需要多方评审的功能
- **安全敏感**：支付、认证等关键功能（需更严格的审查）

---

## 智能体使用策略

### 复用现有智能体
- `bmad-orchestrator`：作为架构识别专家
- `bmad-po`：作为需求分析师（精简模式）
- `bmad-dev`：作为开发工程师
- `bmad-review`：作为代码审查员（可选）
- `bmad-qa`：作为质量保障员（可选）

### 智能体调用模式
```
阶段0 → bmad-orchestrator（仓库扫描）
阶段1 → bmad-po（需求分析，快速模式）
阶段2 → bmad-orchestrator（技术方案，快速模式）
阶段3 → bmad-dev（功能实施）
阶段4 → bmad-review + bmad-qa（质量验证，可选）
阶段5 → bmad-orchestrator（文档生成）
```

---

## 输出目录结构

```
./.claude/
├── quick-context.md                      # 仓库架构快速参考
└── specs/
    └── {feature-name}/
        ├── requirements.md               # 需求摘要
        ├── tech-design.md                # 技术方案
        ├── README.md                     # 功能说明（标准文档）
        ├── QUICKSTART.md                 # 快速说明（--minimal-docs）
        └── CHANGELOG.md                  # 变更记录
```

---

## 成功标准

- ✅ 仓库架构识别准确（主要语言、框架、目录结构）
- ✅ 需求明确（清晰度 ≥ 7分）
- ✅ 技术方案可行（用户批准）
- ✅ 代码实施完成（所有验收标准满足）
- ✅ 质量验证通过（如未跳过）
- ✅ 文档生成完整（根据选项）
- ✅ 总耗时符合预期（简单功能 ≤ 30分钟）

---

## 与其他命令的对比

| 特性 | `/quick-feature` | `/bmad-pilot` | `/code` |
|------|-----------------|---------------|---------|
| 目标场景 | 中小型功能 | 完整项目/大型功能 | 纯代码实现 |
| 需求分析 | 快速分析（5分钟） | 深度分析（≥90分） | 无 |
| 技术方案 | 精简方案 | 完整架构设计 | 无 |
| Sprint规划 | 无 | 有（可选） | 无 |
| 代码实施 | 有 | 有 | 有 |
| 代码审查 | 可选 | 强制 | 无 |
| 测试阶段 | 可选 | 可选 | 无 |
| 用户控制点 | 2个（PRD+方案） | 3个（PRD+架构+Sprint） | 0个 |
| 预估耗时 | 20-60分钟 | 1-4小时+ | 10-30分钟 |
| 文档详细度 | 精简 | 完整 | 无 |

---

## 最佳实践

### 1. 需求描述技巧
```
✅ 好的描述：
"为用户列表页面添加分页功能，每页显示20条，支持前后翻页"

❌ 模糊描述：
"优化用户列表"
```

### 2. 何时跳过测试
```
✅ 可以跳过：
- 纯UI调整（视觉效果）
- 快速原型验证
- 配置文件修改

❌ 不应跳过：
- 业务逻辑变更
- API接口修改
- 数据处理功能
```

### 3. 快速迭代策略
```
第1轮：使用 --skip-tests --minimal-docs 快速实现
第2轮：验证功能后，单独运行测试
第3轮：需要时补充完整文档
```

---

## 故障排查

### 问题：架构识别不准确
**解决**：手动指定关键信息
```bash
/quick-feature "添加登录功能" --scope src/auth
```

### 问题：需求清晰度始终 < 7
**解决**：切换到 `/bmad-pilot` 使用深度需求分析

### 问题：实施时间超预期
**解决**：
1. 检查是否应使用 `/bmad-pilot`（复杂功能）
2. 将功能拆分为多个小功能分别实施

### 问题：代码审查持续不通过
**解决**：
1. 使用 `--skip-review` 先完成实施
2. 后续手动进行代码审查与修复

---

## 后续改进建议

完成功能后，建议：

1. **代码审查**：提交PR请团队成员审查（如跳过了自动审查）
2. **测试补充**：在测试环境进一步验证（如跳过了测试阶段）
3. **文档完善**：根据团队反馈补充文档（如使用了 --minimal-docs）
4. **性能优化**：在生产环境监控性能并优化
5. **技术债跟踪**：记录快速实施过程中留下的技术债

---

## 示例

### 示例1：简单UI组件
```bash
/quick-feature "创建一个加载状态的Spinner组件，支持大中小三种尺寸" --skip-tests
```

**预期流程**：
- 阶段0：识别前端框架（React/Vue/等）
- 阶段1：明确组件API（props、样式）
- 阶段2：确定文件位置（src/components/Spinner.tsx）
- 阶段3：实施组件代码
- 阶段5：生成使用文档

**预估耗时**：15-20分钟

### 示例2：API端点
```bash
/quick-feature "添加获取用户统计信息的API端点 GET /api/users/stats"
```

**预期流程**：
- 阶段0：识别后端框架（Express/FastAPI/等）
- 阶段1：明确API规格（请求/响应格式）
- 阶段2：确定路由与服务文件位置
- 阶段3：实施路由、服务逻辑、数据查询
- 阶段4：验证API响应正确性
- 阶段5：生成API文档

**预估耗时**：30-40分钟

### 示例3：工具函数
```bash
/quick-feature "创建一个日期格式化工具函数，支持多种常见格式" --minimal-docs
```

**预期流程**：
- 阶段0：识别工具函数存放位置
- 阶段1：明确函数签名与格式类型
- 阶段2：确定文件位置（src/utils/date.ts）
- 阶段3：实施函数与单元测试
- 阶段4：运行测试验证
- 阶段5：生成最简使用说明

**预估耗时**：20-25分钟

---

## 总结

`/quick-feature` 命令提供了一个精简高效的功能开发流程，适合中小型功能需求。通过智能仓库识别、快速需求分析、精简技术方案与可选的质量验证，在保证代码质量的前提下显著提升开发效率。

**核心优势**：
- ⚡ 快速：20-60分钟完成中小功能
- 🎯 聚焦：2个关键确认点保证方向正确
- 🔧 灵活：可选跳过测试与审查
- 📊 质量：架构感知保证代码一致性
- 📚 文档：自动生成必要文档

**使用原则**：
- 功能明确 → 快速实施 → 质量验证 → 持续改进
