# Quick Feature 工作流使用指南

## 概述

`/quick-feature` 是一个为中小型功能需求设计的快速开发工作流命令。它通过智能体协作,在保证代码质量的前提下,显著缩短功能开发时间。

### 核心特点

- ⚡ **快速高效**：20-60分钟完成中小功能开发
- 🎯 **用户可控**：2个关键确认点,保证开发方向正确
- 🔧 **灵活配置**：可选跳过测试与代码审查阶段
- 📊 **架构感知**：自动识别仓库结构,遵循现有规范
- 📚 **文档自动化**：自动生成必要的功能说明文档

---

## 快速开始

### 基本用法

```bash
/quick-feature "添加用户导出功能,支持导出为CSV和Excel格式"
```

### 带选项的用法

```bash
# 跳过测试阶段(适合快速原型)
/quick-feature "创建新的通知组件" --skip-tests

# 最简文档(只生成快速使用说明)
/quick-feature "添加数据缓存功能" --minimal-docs

# 指定实施范围
/quick-feature "优化查询性能" --scope src/database

# 组合使用多个选项
/quick-feature "快速实现搜索功能" --skip-tests --minimal-docs
```

---

## 工作流程详解

### 阶段 0: 仓库架构识别 (自动)

**目标**: 快速理解项目结构与技术栈

**执行内容**:
- 识别项目类型(前端/后端/全栈等)
- 检测技术栈(语言、框架、工具)
- 分析代码组织模式
- 扫描可复用组件
- 识别开发约定

**输出**: `./.claude/quick-context.md` (架构快速参考)

**耗时**: 30-60秒

---

### 阶段 1: 需求快速分析 (交互式)

**目标**: 5分钟内明确功能边界与验收标准

**执行流程**:

1. **智能解析**: 自动分析需求描述
2. **质量评分**: 计算需求清晰度(1-10分)
3. **条件分支**:
   - 如果清晰度 < 7: 提出3个澄清问题
   - 如果清晰度 ≥ 7: 直接生成PRD摘要

**用户确认点 #1** 🛑

展示需求摘要并等待用户确认:

```
📋 功能需求摘要

核心功能: [一句话描述]

用户故事:
- 作为[角色], 我想[功能], 以便[目标]

验收标准:
✓ [标准1]
✓ [标准2]
✓ [标准3]

预估复杂度: [简单/中等/复杂]
预计文件数: [约X个文件]

是否开始实施? (yes/no)
```

**只有用户确认后才继续**

**耗时**: 3-5分钟

---

### 阶段 2: 技术方案设计 (快速通道)

**目标**: 10分钟内完成技术方案

**设计内容**:
- 文件规划(新建/修改文件列表)
- 组件设计(核心接口定义)
- 数据流设计(输入输出)
- 实施顺序(1-5步)

**用户确认点 #2** 🛑

展示技术方案摘要并等待用户确认:

```
🏗️ 技术方案摘要

文件操作:
📝 新建: [文件1], [文件2]
✏️ 修改: [文件3]

核心接口:
- [接口1]: [说明]
- [接口2]: [说明]

实施步骤:
1. [步骤1] (预估: 5分钟)
2. [步骤2] (预估: 10分钟)
...

是否批准方案并开始开发? (yes/no)
```

**只有用户批准后才开始编码**

**耗时**: 5-10分钟

---

### 阶段 3: 功能实施 (自动)

**目标**: 按技术方案完成代码实现

**实施要求**:
- 遵循仓库代码风格
- 添加必要注释与文档
- 处理边界情况与错误
- 复用现有组件

**进度展示**:

```
🚀 开发进度

✅ 步骤1: 创建基础接口定义
   📝 src/types/feature.ts
✅ 步骤2: 实现核心逻辑
   📝 src/services/feature-service.ts
⏳ 步骤3: 集成到现有系统 (进行中...)
⬜ 步骤4: 添加错误处理
⬜ 步骤5: 编写文档
```

**耗时**: 根据功能复杂度而定

---

### 阶段 4: 质量验证 (可选)

#### 4.1 代码审查 (除非 --skip-review)

**审查要点**:
- 功能完整性
- 代码质量
- 架构一致性
- 潜在问题

**输出**: 审查结果(通过/有风险/不通过)

#### 4.2 测试验证 (除非 --skip-tests)

**验证内容**:
- 功能测试(验证验收标准)
- 集成测试(兼容性检查)

**输出**: 测试报告与结论

**耗时**: 5-15分钟(如不跳过)

---

### 阶段 5: 交付与文档 (自动)

**标准文档** (默认):
- `README.md`: 功能说明与使用方法
- `CHANGELOG.md`: 变更记录
- 代码内文档: JSDoc/注释

**最简文档** (--minimal-docs):
- `QUICKSTART.md`: 一句话描述 + 使用示例

**交付摘要**:

```
🎉 功能实施完成

📋 功能名称: [功能名]
⏱️ 总耗时: [时间]
📊 复杂度: [简单/中等/复杂]

📁 文件变更:
新建: [文件列表]
修改: [文件列表]

✅ 验收标准: 全部通过 (X/X)

📚 文档位置:
  - 功能说明: ./.claude/specs/{feature-name}/README.md
  - 技术方案: ./.claude/specs/{feature-name}/tech-design.md
```

**耗时**: 2-5分钟

---

## 命令选项说明

### --skip-tests

跳过测试验证阶段

**适用场景**:
- ✅ 纯UI调整(视觉效果)
- ✅ 快速原型验证
- ✅ 配置文件修改

**不适用场景**:
- ❌ 业务逻辑变更
- ❌ API接口修改
- ❌ 数据处理功能

**示例**:
```bash
/quick-feature "调整按钮样式" --skip-tests
```

---

### --skip-review

跳过代码审查阶段(不推荐)

**适用场景**:
- 快速原型开发
- 实验性功能
- 后续会进行人工审查

**示例**:
```bash
/quick-feature "添加调试工具" --skip-review
```

---

### --minimal-docs

生成最简化文档

**输出内容**:
- 功能一句话描述
- 1-2个使用示例
- 新增关键文件路径

**适用场景**:
- 内部工具开发
- 临时功能
- 后续会补充完整文档

**示例**:
```bash
/quick-feature "创建日期格式化工具" --minimal-docs
```

---

### --scope <PATH>

指定实施范围

**作用**:
- 限制架构扫描范围
- 明确代码修改区域
- 提高分析准确性

**示例**:
```bash
/quick-feature "优化数据库查询" --scope src/database
/quick-feature "重构用户模块" --scope src/modules/user
```

---

## 时间预估

| 功能复杂度 | 标准流程 | 快速通道(跳过测试) |
|-----------|---------|-------------------|
| 简单功能 | 20-30分钟 | 15-20分钟 |
| 中等功能 | 40-60分钟 | 30-40分钟 |
| 复杂功能 | 建议使用 `/bmad-pilot` | - |

**时间分布** (中等功能为例):

```
阶段0: 仓库扫描       ████░░░░░░ (2分钟, 3%)
阶段1: 需求分析       ████████░░ (5分钟, 8%)
阶段2: 技术方案       ████████████░░ (8分钟, 13%)
阶段3: 功能实施       ████████████████████████████████ (35分钟, 58%)
阶段4: 质量验证       ████████░░ (8分钟, 13%)
阶段5: 交付文档       ███░░░░░░░ (2分钟, 3%)
                      ─────────────────────────
总计                  60分钟
```

---

## 使用场景

### ✅ 适用场景

| 场景类型 | 示例 | 预估时间 |
|---------|------|---------|
| 小型功能 | 新增工具函数、UI组件 | 15-25分钟 |
| 功能增强 | 在现有模块扩展功能 | 25-40分钟 |
| Bug修复后补充 | 增加防御性代码 | 20-30分钟 |
| 快速原型 | 验证技术可行性 | 20-30分钟 |
| 维护性任务 | 重构、优化、文档补充 | 30-45分钟 |

---

### ❌ 不适用场景

| 场景类型 | 原因 | 推荐方案 |
|---------|------|---------|
| 大型功能 | 涉及多个模块、复杂交互 | 使用 `/bmad-pilot` |
| 架构变更 | 需要重大架构调整 | 使用 `/bmad-pilot` |
| 跨团队协作 | 需要多方评审 | 使用完整流程 + 人工审查 |
| 安全敏感功能 | 支付、认证等关键功能 | 使用 `/bmad-pilot` + 安全审计 |

---

## 实战示例

### 示例 1: 简单 UI 组件

**需求**: 创建加载状态的 Spinner 组件

```bash
/quick-feature "创建一个加载状态的Spinner组件, 支持大中小三种尺寸" --skip-tests
```

**执行流程**:

1. **仓库扫描**: 识别前端框架(React)
2. **需求分析**: 
   - 核心功能: 可配置尺寸的加载动画组件
   - 验收标准: 支持 small/medium/large 三种尺寸
3. **技术方案**:
   - 新建 `src/components/Spinner/Spinner.tsx`
   - 新建 `src/components/Spinner/Spinner.css`
4. **功能实施**: 实现组件代码与样式
5. **交付文档**: 生成使用示例

**预估耗时**: 15-20分钟

**输出文件**:
- `src/components/Spinner/Spinner.tsx`
- `src/components/Spinner/Spinner.css`
- `.claude/specs/spinner/README.md`

---

### 示例 2: API 端点

**需求**: 添加用户统计信息 API

```bash
/quick-feature "添加获取用户统计信息的API端点 GET /api/users/stats, 返回用户总数、活跃用户数、新增用户数"
```

**执行流程**:

1. **仓库扫描**: 识别后端框架(Express.js)
2. **需求分析**:
   - 核心功能: 统计API端点
   - 验收标准: 正确返回三项统计数据
3. **技术方案**:
   - 新建 `src/routes/users.ts` 添加路由
   - 新建 `src/services/user-stats.ts` 统计逻辑
   - 修改 `src/app.ts` 注册路由
4. **功能实施**: 实现路由、服务、数据查询
5. **质量验证**: 测试API响应格式

**预估耗时**: 30-40分钟

**输出文件**:
- `src/routes/users.ts`
- `src/services/user-stats.ts`
- `.claude/specs/user-stats-api/README.md`

---

### 示例 3: 工具函数

**需求**: 日期格式化工具

```bash
/quick-feature "创建一个日期格式化工具函数, 支持YYYY-MM-DD、MM/DD/YYYY、相对时间等常见格式" --minimal-docs
```

**执行流程**:

1. **仓库扫描**: 识别工具函数目录 `src/utils`
2. **需求分析**:
   - 核心功能: 多格式日期转换
   - 验收标准: 支持至少3种格式
3. **技术方案**:
   - 新建 `src/utils/date-formatter.ts`
   - 添加单元测试 `src/utils/date-formatter.test.ts`
4. **功能实施**: 实现格式化函数与测试
5. **交付文档**: 生成快速使用说明

**预估耗时**: 20-25分钟

**输出文件**:
- `src/utils/date-formatter.ts`
- `src/utils/date-formatter.test.ts`
- `.claude/specs/date-formatter/QUICKSTART.md`

---

## 与其他命令的对比

### 功能对比表

| 特性 | `/quick-feature` | `/bmad-pilot` | `/code` |
|------|-----------------|---------------|---------|
| **目标场景** | 中小型功能 | 完整项目/大型功能 | 纯代码实现 |
| **需求分析** | 快速分析(5分钟) | 深度分析(≥90分) | 无 |
| **技术方案** | 精简方案 | 完整架构设计 | 无 |
| **Sprint规划** | 无 | 有(可选) | 无 |
| **代码实施** | ✅ | ✅ | ✅ |
| **代码审查** | 可选 | 强制 | 无 |
| **测试阶段** | 可选 | 可选 | 无 |
| **用户控制点** | 2个(PRD+方案) | 3个(PRD+架构+Sprint) | 0个 |
| **预估耗时** | 20-60分钟 | 1-4小时+ | 10-30分钟 |
| **文档详细度** | 精简 | 完整 | 无 |
| **适用复杂度** | 简单-中等 | 中等-复杂 | 任意 |

---

### 选择决策树

```
需求分析
    │
    ├─ 是否需要详细需求分析与架构设计?
    │   ├─ 是 → 使用 /bmad-pilot
    │   └─ 否 → 继续
    │
    ├─ 是否需要文档与质量保障?
    │   ├─ 是 → 使用 /quick-feature
    │   └─ 否 → 使用 /code
    │
    └─ 功能复杂度?
        ├─ 简单 → /quick-feature --skip-tests
        ├─ 中等 → /quick-feature
        └─ 复杂 → /bmad-pilot
```

---

## 最佳实践

### 1. 编写清晰的需求描述

**✅ 好的描述**:

```bash
# 明确具体, 包含关键细节
/quick-feature "为用户列表页面添加分页功能, 每页显示20条, 支持前后翻页和跳转到指定页"

# 指定技术要求
/quick-feature "使用Redis实现API响应缓存, 缓存时间5分钟, 支持按key失效"

# 包含验收标准
/quick-feature "添加文件上传功能, 支持jpg/png格式, 最大5MB, 上传后显示预览"
```

**❌ 模糊的描述**:

```bash
# 缺少细节
/quick-feature "优化用户列表"

# 目标不明确
/quick-feature "改进性能"

# 范围过大
/quick-feature "重构整个用户模块"
```

---

### 2. 合理使用选项组合

**快速原型开发**:
```bash
/quick-feature "验证新的搜索算法" --skip-tests --minimal-docs
```

**生产功能开发**:
```bash
/quick-feature "添加支付回调处理" --scope src/payment
# 保留所有质量检查
```

**UI/样式调整**:
```bash
/quick-feature "调整导航栏样式" --skip-tests
```

---

### 3. 快速迭代策略

**三轮迭代法**:

```bash
# 第1轮: 快速实现核心功能
/quick-feature "实现基础搜索功能" --skip-tests --minimal-docs

# (验证功能可行性后)

# 第2轮: 补充测试
# 手动编写测试或运行测试命令

# 第3轮: 完善文档
# 根据团队反馈补充完整文档
```

---

### 4. 何时跳过测试

**✅ 可以跳过**:
- 纯视觉调整(颜色、布局、动画)
- 快速原型验证
- 配置文件修改
- 临时调试代码

**❌ 不应跳过**:
- 业务逻辑变更
- API 接口修改
- 数据处理功能
- 安全相关代码

---

### 5. 复杂功能的拆分策略

**示例**: 用户认证系统

**❌ 不推荐** (范围过大):
```bash
/quick-feature "实现完整的用户认证系统, 包括注册、登录、找回密码、邮箱验证"
```

**✅ 推荐** (拆分为多个小功能):
```bash
# 第1步: 基础登录
/quick-feature "实现用户登录功能, 支持邮箱+密码登录"

# 第2步: 用户注册
/quick-feature "实现用户注册功能, 包含表单验证和密码加密"

# 第3步: 找回密码
/quick-feature "实现找回密码功能, 通过邮箱发送重置链接"

# 第4步: 邮箱验证
/quick-feature "添加邮箱验证功能, 注册后发送验证邮件"
```

---

## 故障排查

### 问题 1: 架构识别不准确

**症状**: 扫描结果与实际项目不符

**解决方案**:

```bash
# 1. 指定分析范围
/quick-feature "添加缓存功能" --scope src/cache

# 2. 手动提供架构信息(在需求描述中)
/quick-feature "使用Redis实现缓存, 项目使用Express.js框架, 缓存逻辑放在src/services"
```

---

### 问题 2: 需求清晰度始终 < 7

**症状**: 多次澄清后仍无法达到清晰度要求

**解决方案**:

1. **切换到深度需求分析**:
   ```bash
   /bmad-pilot "实现复杂的数据分析功能"
   ```

2. **先整理需求再执行**:
   - 手动编写详细需求文档
   - 在需求描述中包含更多细节
   - 使用 `/requirements-pilot` 先生成PRD

---

### 问题 3: 实施时间超出预期

**症状**: 功能开发耗时远超预估

**可能原因与解决方案**:

1. **功能复杂度被低估**:
   ```bash
   # 停止当前任务, 切换到完整流程
   /bmad-pilot "完成[当前功能]"
   ```

2. **需要拆分为多个小功能**:
   - 按模块拆分
   - 按优先级分阶段实施

3. **缺少必要的基础设施**:
   - 先实施基础功能
   - 再实施业务功能

---

### 问题 4: 代码审查持续不通过

**症状**: 审查阶段反复发现问题

**解决方案**:

```bash
# 1. 先跳过审查完成实施
/quick-feature "添加[功能]" --skip-review

# 2. 后续手动审查与修复
# - 提交PR请团队成员审查
# - 根据反馈逐项修复
# - 必要时重构代码
```

---

### 问题 5: 测试验证失败

**症状**: 功能实施完成但测试不通过

**解决方案**:

1. **检查验收标准是否合理**:
   - 标准是否过于严格?
   - 是否有未考虑的边界情况?

2. **手动测试确认实际情况**:
   - 功能是否确实有问题?
   - 还是测试逻辑有误?

3. **迭代修复**:
   - 根据测试报告逐项修复
   - 重新运行测试验证

---

## 输出目录结构

完成功能开发后, 将生成以下目录结构:

```
./.claude/
├── quick-context.md                      # 仓库架构快速参考
│
└── specs/
    └── {feature-name}/                   # 功能名称(kebab-case)
        ├── requirements.md               # 需求摘要(PRD)
        ├── tech-design.md                # 技术方案
        ├── README.md                     # 功能说明(标准文档)
        ├── QUICKSTART.md                 # 快速说明(--minimal-docs)
        └── CHANGELOG.md                  # 变更记录

# 实际代码文件根据技术方案创建在项目源码目录中
```

**文件说明**:

| 文件 | 内容 | 何时生成 |
|------|------|---------|
| `quick-context.md` | 仓库架构摘要 | 阶段0自动生成, 全局复用 |
| `requirements.md` | 需求分析结果 | 阶段1用户确认后 |
| `tech-design.md` | 技术方案 | 阶段2用户批准后 |
| `README.md` | 功能说明与使用方法 | 阶段5(标准文档模式) |
| `QUICKSTART.md` | 快速使用说明 | 阶段5(--minimal-docs) |
| `CHANGELOG.md` | 文件变更记录 | 阶段5(标准文档模式) |

---

## 成功标准

功能开发被认为成功完成, 需满足以下标准:

### ✅ 质量标准

- [ ] 仓库架构识别准确(主要语言、框架、目录结构)
- [ ] 需求明确(清晰度 ≥ 7分)
- [ ] 技术方案可行(用户批准)
- [ ] 代码实施完成(所有验收标准满足)
- [ ] 质量验证通过(如未跳过)
- [ ] 文档生成完整(根据选项)

### ⏱️ 时间标准

- [ ] 简单功能 ≤ 30分钟
- [ ] 中等功能 ≤ 60分钟
- [ ] 复杂功能: 建议切换到 `/bmad-pilot`

### 📊 交付标准

- [ ] 所有新增文件已创建
- [ ] 所有修改文件已更新
- [ ] 代码遵循项目规范
- [ ] 必要的注释与文档已添加
- [ ] 验收标准已验证(如未跳过测试)

---

## 后续改进建议

完成功能后, 建议进行以下后续工作:

### 1. 代码审查

**如果跳过了自动审查**:
- 提交 Pull Request
- 请团队成员审查代码
- 根据反馈修复问题

### 2. 测试补充

**如果跳过了测试阶段**:
- 在测试环境进一步验证
- 编写单元测试
- 进行集成测试

### 3. 文档完善

**如果使用了 --minimal-docs**:
- 根据团队反馈补充文档
- 添加 API 文档
- 更新项目 README

### 4. 性能优化

- 在生产环境监控性能
- 识别性能瓶颈
- 进行针对性优化

### 5. 技术债跟踪

- 记录快速实施过程中的妥协
- 制定技术债偿还计划
- 定期重构与优化

---

## 常见问题 (FAQ)

### Q1: 何时使用 `/quick-feature` 而不是 `/bmad-pilot`?

**A**: 
- 使用 `/quick-feature`: 需求明确、范围小、时间紧
- 使用 `/bmad-pilot`: 需求复杂、涉及架构变更、需要完整文档

### Q2: 可以在开发过程中更改需求吗?

**A**: 
- 在阶段1或阶段2确认前: 可以随时修改需求
- 开始实施后: 不推荐大幅更改, 建议重新启动工作流

### Q3: 跳过测试是否会影响代码质量?

**A**: 
- 代码实施阶段仍会进行基本的自测
- 跳过的是系统化的测试验证
- 建议后续补充测试

### Q4: 生成的文档可以手动编辑吗?

**A**: 
- 可以, 所有生成的文档都可以手动编辑
- 建议在生成后根据实际情况完善

### Q5: 工作流可以中断后继续吗?

**A**: 
- 在用户确认点可以随时中断
- 不支持断点续传, 中断后需重新开始

---

## 总结

`/quick-feature` 提供了一个高效的中小型功能开发流程, 适合以下场景:

### 🎯 核心优势

1. **快速**: 20-60分钟完成中小功能
2. **可控**: 2个关键确认点保证方向正确
3. **灵活**: 可选跳过测试与审查
4. **质量**: 架构感知保证代码一致性
5. **文档**: 自动生成必要文档

### 📋 适用原则

- **功能明确** → 快速实施
- **质量验证** → 持续改进
- **文档完善** → 知识沉淀
- **迭代优化** → 长期维护

### 🚀 开始使用

现在就可以尝试使用 `/quick-feature` 快速实现你的下一个功能需求!

```bash
/quick-feature "你的功能描述" [OPTIONS]
```

---

**相关命令**:
- `/bmad-pilot`: 完整的项目开发流程
- `/code`: 纯代码实现(无需求分析)
- `/requirements-pilot`: 深度需求分析

**文档版本**: v1.0  
**最后更新**: 2025-01-25
