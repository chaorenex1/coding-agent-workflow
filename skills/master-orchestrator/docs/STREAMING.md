# å®æ—¶æµå¼è¾“å‡º (Real-time Streaming Output)

master-orchestrator æ”¯æŒå®æ—¶æµå¼è¾“å‡ºï¼Œå…è®¸ç”¨æˆ·åœ¨ AI å¤„ç†ä»»åŠ¡æ—¶çœ‹åˆ°å³æ—¶åé¦ˆã€‚

---

## å¿«é€Ÿå¼€å§‹

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# å¯ç”¨æµå¼è¾“å‡º
python -m master-orchestrator "your query" --stream

# æˆ–ä½¿ç”¨çŸ­é€‰é¡¹
python -m master-orchestrator "your query" -s

# æµå¼è¾“å‡º + è¯¦ç»†æ¨¡å¼
python -m master-orchestrator "analyze this code" --stream --verbose
```

### Python API ä½¿ç”¨

```python
from master_orchestrator import MasterOrchestrator

orch = MasterOrchestrator()

# å¯ç”¨æµå¼è¾“å‡º
result = orch.process(
    "your query",
    stream_output=True
)
```

---

## åŠŸèƒ½ç‰¹æ€§

### âœ… å®æ—¶åé¦ˆ

- ç«‹å³æ˜¾ç¤º AI å¼€å§‹å¤„ç†
- å®æ—¶æ˜¾ç¤º AI è¾“å‡ºå†…å®¹
- å®æ—¶æ˜¾ç¤ºå·¥å…·è°ƒç”¨å’Œç»“æœ
- æ˜¾ç¤ºä»»åŠ¡å®ŒæˆçŠ¶æ€

### âœ… æ ¼å¼åŒ–è¾“å‡º

äº‹ä»¶è‡ªåŠ¨æ ¼å¼åŒ–ä¸ºå¯è¯»æ–‡æœ¬ï¼š

| äº‹ä»¶ç±»å‹ | å›¾æ ‡ | ç¤ºä¾‹è¾“å‡º |
|---------|------|---------|
| ä»»åŠ¡å¼€å§‹ | ğŸš€ | `ğŸš€ ä»»åŠ¡å¼€å§‹ | Run ID: abc123... | Model: claude` |
| AI è¾“å‡º | ğŸ’¬ | `ğŸ’¬ æ­£åœ¨åˆ†æä»£ç ç»“æ„...` |
| å·¥å…·è°ƒç”¨ | ğŸ”§ | `ğŸ”§ è°ƒç”¨å·¥å…·: Grep | å‚æ•°: pattern=...` |
| å·¥å…·å®Œæˆ | âœ… | `âœ… å·¥å…·å®Œæˆ: Grep` |
| ä»»åŠ¡å®Œæˆ | ğŸ | `ğŸ ä»»åŠ¡å®Œæˆ | Run ID: abc123...` |

### âœ… å‘åå…¼å®¹

- é»˜è®¤å…³é—­æµå¼è¾“å‡ºï¼ˆæ‰¹é‡æ¨¡å¼ï¼‰
- é€šè¿‡ `--stream` å‚æ•°æ˜¾å¼å¯ç”¨
- ä¸å½±å“ç°æœ‰è„šæœ¬å’Œå·¥ä½œæµ

---

## å·¥ä½œåŸç†

### æ‰¹é‡æ¨¡å¼ (é»˜è®¤)

```
ç”¨æˆ·è¯·æ±‚ â†’ ç­‰å¾…å®Œæˆ â†’ æ˜¾ç¤ºç»“æœæ‘˜è¦
```

**ç‰¹ç‚¹**ï¼š
- ç­‰å¾…ä»»åŠ¡å®Œæˆåä¸€æ¬¡æ€§æ˜¾ç¤ºç»“æœ
- è¾“å‡ºç®€æ´ï¼Œé€‚åˆè„šæœ¬é›†æˆ
- æ— å®æ—¶åé¦ˆ

### æµå¼æ¨¡å¼ (--stream)

```
ç”¨æˆ·è¯·æ±‚ â†’ å®æ—¶æ˜¾ç¤ºäº‹ä»¶ â†’ æ˜¾ç¤ºå®Œæˆæ‘˜è¦
           â†“
     AI å¼€å§‹ â†’ AI è¾“å‡º â†’ å·¥å…·è°ƒç”¨ â†’ å·¥å…·ç»“æœ
```

**ç‰¹ç‚¹**ï¼š
- ç«‹å³æ˜¾ç¤ºæ¯ä¸ªå¤„ç†æ­¥éª¤
- æä¾›å®æ—¶åé¦ˆå’Œè¿›åº¦
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰å›è°ƒå‡½æ•°

```python
from core.stream_handler import StreamHandler

# è‡ªå®šä¹‰å›è°ƒ
def my_callback(line):
    # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
    print(f"[LOG] {line}")

handler = StreamHandler(callback=my_callback)

# å¤„ç† JSONL äº‹ä»¶
handler.process_line('{"type":"assistant.output","output":"Hello"}')
```

### ç¦ç”¨ Emoji å›¾æ ‡

```python
from core.output_formatter import OutputFormatter

# ç¦ç”¨å›¾æ ‡ï¼ˆé€‚ç”¨äºä¸æ”¯æŒ emoji çš„ç»ˆç«¯ï¼‰
OutputFormatter.disable_icons()

# æ¢å¤å›¾æ ‡
OutputFormatter.enable_icons()
```

### æµå¼è¾“å‡ºç¼“å†²

```python
from core.stream_handler import StreamBuffer

buffer = StreamBuffer(max_size=10_000_000)  # 10MB

# æ”¶é›†è¾“å‡º
buffer.append("line 1\n")
buffer.append("line 2\n")

# è·å–å®Œæ•´è¾“å‡º
full_output = buffer.get_full_output()
```

---

## æ€§èƒ½

### å»¶è¿ŸæŒ‡æ ‡

| æŒ‡æ ‡ | æ‰¹é‡æ¨¡å¼ | æµå¼æ¨¡å¼ |
|------|---------|---------|
| é¦–å­—èŠ‚å»¶è¿Ÿ | N/A (ç­‰å¾…å®Œæˆ) | <1 ç§’ |
| è¡Œå¤„ç†å»¶è¿Ÿ | N/A | <10ms/è¡Œ |
| æ€»è€—æ—¶å¼€é”€ | åŸºå‡† | <5% |
| å†…å­˜ä½¿ç”¨ | åŸºå‡† | +<50MB |

### ä¼˜åŒ–

- ä½¿ç”¨è¡Œç¼“å†² (`bufsize=1`) å¹³è¡¡å»¶è¿Ÿå’Œæ€§èƒ½
- JSON è§£æå¤±è´¥è‡ªåŠ¨é™çº§åˆ°åŸå§‹è¾“å‡º
- æ”¯æŒè¶…é•¿è¡Œæˆªæ–­ï¼ˆé˜²æ­¢å†…å­˜æº¢å‡ºï¼‰

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæµå¼è¾“å‡ºæ²¡æœ‰æ˜¾ç¤º

**å¯èƒ½åŸå› **ï¼š
1. æœªæ·»åŠ  `--stream` å‚æ•°
2. è¾“å‡ºè¢«é‡å®šå‘æˆ–ç¼“å†²

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿ä½¿ç”¨ --stream
python -m master-orchestrator "query" --stream

# ç¦ç”¨ Python è¾“å‡ºç¼“å†²
python -u -m master-orchestrator "query" --stream
```

### é—®é¢˜ï¼šEmoji æ˜¾ç¤ºå¼‚å¸¸

**å¯èƒ½åŸå› **ï¼šç»ˆç«¯ä¸æ”¯æŒ Unicode emoji

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# åœ¨ä»£ç ä¸­ç¦ç”¨å›¾æ ‡
from core.output_formatter import OutputFormatter
OutputFormatter.disable_icons()
```

æˆ–è€…åœ¨ç»ˆç«¯è®¾ç½®ä¸­å¯ç”¨ UTF-8 æ”¯æŒï¼š
```bash
# Windows (PowerShell)
chcp 65001

# Linux/macOS
export LANG=en_US.UTF-8
```

### é—®é¢˜ï¼šè¾“å‡ºå»¶è¿Ÿè¾ƒé«˜

**å¯èƒ½åŸå› **ï¼šç½‘ç»œå»¶è¿Ÿæˆ– memex-cli æ€§èƒ½

**ä¼˜åŒ–**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- å¢åŠ ç¼“å†²å¤§å°ï¼ˆtrade-off å»¶è¿Ÿï¼‰

---

## ç¤ºä¾‹è¾“å‡º

### æ‰¹é‡æ¨¡å¼

```
[MasterOrchestrator] å¤„ç†è¯·æ±‚: analyze project

[æ‰§è¡Œå®Œæˆ]
åç«¯: claude
æˆåŠŸ: True
è€—æ—¶: 15.3s
Run ID: abc123...

è¾“å‡ºé¢„è§ˆ:
{"v":1,"type":"event.start"...}

å·¥å…·è°ƒç”¨é“¾: [('Grep', True), ('Read', True)]
```

### æµå¼æ¨¡å¼

```
ğŸš€ ä»»åŠ¡å¼€å§‹ | Run ID: abc123... | Model: claude-sonnet-4-5
ğŸ’¬ æ­£åœ¨åˆ†æé¡¹ç›®ç»“æ„...
ğŸ”§ è°ƒç”¨å·¥å…·: Grep | å‚æ•°: pattern="*.py"
âœ… å·¥å…·å®Œæˆ: Grep
ğŸ’¬ æ‰¾åˆ° 15 ä¸ª Python æ–‡ä»¶
ğŸ”§ è°ƒç”¨å·¥å…·: Read | å‚æ•°: file="main.py"
âœ… å·¥å…·å®Œæˆ: Read
ğŸ’¬ é¡¹ç›®ä½¿ç”¨ Flask æ¡†æ¶ï¼ŒåŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š
   - auth: ç”¨æˆ·è®¤è¯
   - api: REST API
   - db: æ•°æ®åº“æ“ä½œ
ğŸ ä»»åŠ¡å®Œæˆ | Run ID: abc123...
============================================================
[å®Œæˆ] åç«¯: claude | è€—æ—¶: 15.3s | æˆåŠŸ: True
```

---

## æœ€ä½³å®è·µ

1. **äº¤äº’å¼ä½¿ç”¨ä¼˜å…ˆæµå¼æ¨¡å¼**
   - ç”¨æˆ·æ‰‹åŠ¨æ‰§è¡Œæ—¶ä½¿ç”¨ `--stream`
   - æä¾›å®æ—¶åé¦ˆï¼Œæ”¹å–„ä½“éªŒ

2. **è„šæœ¬é›†æˆä½¿ç”¨æ‰¹é‡æ¨¡å¼**
   - CI/CD ç®¡é“ä¸­ä¸ä½¿ç”¨ `--stream`
   - è¾“å‡ºç®€æ´ï¼Œæ˜“äºè§£æ

3. **é•¿æ—¶é—´ä»»åŠ¡ä½¿ç”¨æµå¼æ¨¡å¼**
   - å¤æ‚åˆ†ææˆ–ä»£ç ç”Ÿæˆ
   - é¿å…ç”¨æˆ·ç­‰å¾…ç„¦è™‘

4. **è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼**
   - ä½¿ç”¨è‡ªå®šä¹‰å›è°ƒå¤„ç†ç‰¹æ®Šéœ€æ±‚
   - é›†æˆåˆ°æ—¥å¿—ç³»ç»Ÿæˆ–ç›‘æ§

---

## ç›¸å…³æ–‡æ¡£

- [README.md](../README.md) - é¡¹ç›®æ¦‚è¿°
- [SKILL.md](../SKILL.md) - æŠ€èƒ½å®šä¹‰
- [examples/demo_stream_output.py](../examples/demo_stream_output.py) - æ¼”ç¤ºä»£ç 

---

**è®© AI å¤„ç†è¿‡ç¨‹å¯è§†åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼** ğŸš€
