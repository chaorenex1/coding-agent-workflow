# Development Workflow Skill
# 多阶段开发工作流自动化

name: dev-workflow
version: 1.0.0
description: 5阶段自动化开发流程 - 需求分析 → 功能设计 → UX设计 → 开发计划 → 实现

# Backend配置
backend: codex
model: deepseek-reasoner
temperature: 0.7
max_tokens: 8000

# 输出格式
output_format: text

# 系统提示词
system_prompt: |
  你是多阶段开发流程专家。按照5个阶段处理用户的开发需求。

  ## 阶段1: 需求分析 (Requirements Analysis)
  目标：理解用户需求，明确功能范围
  输出：
  - 核心需求列表
  - 功能优先级
  - 技术约束
  - 成功标准

  ## 阶段2: 功能设计 (Feature Design)
  目标：设计功能架构和数据模型
  输出：
  - 功能模块划分
  - 数据模型设计
  - API接口定义
  - 技术选型

  ## 阶段3: UX设计 (UX Design)
  目标：设计用户界面和交互流程
  输出：
  - 页面结构
  - 交互流程
  - UI组件列表
  - 用户体验优化建议

  ## 阶段4: 开发计划 (Development Plan)
  目标：制定详细的实现计划
  输出：
  - 任务分解（前端/后端/数据库）
  - 实现顺序
  - 技术难点和风险
  - 测试策略

  ## 阶段5: 实现建议 (Implementation)
  目标：提供关键代码实现建议
  输出：
  - 核心代码结构
  - 关键功能实现示例
  - 最佳实践建议
  - 常见陷阱提醒

  ## 输出格式
  每个阶段使用以下格式：

  ========================================
  阶段 X: [阶段名称]
  ========================================

  [阶段内容]

  ----------------------------------------
  阶段总结：[1-2句话总结]
  ========================================

# 用户提示词模板
user_prompt_template: |
  用户开发需求：
  {{request}}

  请按照5个阶段完整分析和规划此开发任务。
  每个阶段都要详细、实用、可操作。

# 示例
examples:
  - name: 电商系统开发
    input:
      request: "开发一个简单的电商管理系统，包含用户管理、商品管理、订单处理"
    output: |
      ========================================
      阶段 1: 需求分析
      ========================================

      核心需求：
      1. 用户管理
         - 用户注册/登录
         - 用户信息管理
         - 权限控制（管理员/普通用户）

      2. 商品管理
         - 商品CRUD
         - 商品分类
         - 库存管理

      3. 订单处理
         - 下单流程
         - 订单状态管理
         - 订单查询

      功能优先级：
      P0: 用户登录、商品展示、下单
      P1: 用户注册、商品管理、订单查询
      P2: 权限控制、库存预警

      技术约束：
      - Web应用（支持移动端）
      - 并发用户: ~100
      - 数据量: ~10000商品

      成功标准：
      - 用户能完整完成购买流程
      - 管理员能管理商品和订单
      - 响应时间 <2s

      ----------------------------------------
      阶段总结：明确了3大核心模块和优先级，技术要求适中。
      ========================================

      ========================================
      阶段 2: 功能设计
      ========================================

      功能模块：
      1. auth - 认证授权
      2. user - 用户管理
      3. product - 商品管理
      4. order - 订单管理
      5. api - 统一API接口

      数据模型：
      ```
      User {
        id, username, email, password_hash,
        role, created_at
      }

      Product {
        id, name, description, price, stock,
        category_id, image_url, created_at
      }

      Order {
        id, user_id, total_price, status,
        items (JSON), created_at
      }
      ```

      API接口：
      - POST /api/auth/login
      - GET /api/products
      - POST /api/orders
      - GET /api/orders/:id

      技术选型：
      - 后端: Python Flask / FastAPI
      - 数据库: PostgreSQL
      - 前端: React / Vue
      - 认证: JWT

      ----------------------------------------
      阶段总结：设计了清晰的模块划分和RESTful API。
      ========================================

      ========================================
      阶段 3: UX设计
      ========================================

      页面结构：
      1. 登录页 (/login)
      2. 商品列表页 (/products)
      3. 商品详情页 (/products/:id)
      4. 购物车页 (/cart)
      5. 订单页 (/orders)
      6. 管理后台 (/admin)

      交互流程：
      用户购物流程：
      登录 → 浏览商品 → 加入购物车 → 确认订单 → 支付 → 完成

      管理员流程：
      登录 → 管理后台 → 商品管理/订单管理

      UI组件：
      - ProductCard: 商品卡片
      - CartItem: 购物车项
      - OrderList: 订单列表
      - AdminTable: 管理表格

      UX优化：
      - 商品搜索和筛选
      - 购物车实时更新
      - 订单状态追踪
      - 移动端适配

      ----------------------------------------
      阶段总结：设计了直观的用户流程和响应式界面。
      ========================================

      ========================================
      阶段 4: 开发计划
      ========================================

      任务分解：

      后端任务：
      1. 搭建基础框架 (1天)
      2. 实现用户认证 (1天)
      3. 实现商品CRUD (1天)
      4. 实现订单处理 (2天)
      5. API测试 (1天)

      前端任务：
      1. 搭建项目结构 (0.5天)
      2. 实现登录页 (0.5天)
      3. 实现商品列表和详情 (1天)
      4. 实现购物车 (1天)
      5. 实现订单页 (1天)
      6. 管理后台 (2天)

      数据库任务：
      1. 设计schema (0.5天)
      2. 创建迁移脚本 (0.5天)
      3. 准备测试数据 (0.5天)

      实现顺序：
      1. 先后端API（可测试）
      2. 再前端页面（可演示）
      3. 最后管理后台（锦上添花）

      技术难点：
      - 订单并发处理（库存扣减）
      - 购物车状态管理
      - 权限验证中间件

      测试策略：
      - 单元测试：核心业务逻辑
      - 集成测试：API端到端
      - E2E测试：关键用户流程

      ----------------------------------------
      阶段总结：总工期约10-12天，关键路径是订单处理。
      ========================================

      ========================================
      阶段 5: 实现建议
      ========================================

      核心代码结构：
      ```
      backend/
        app/
          models/        # 数据模型
          routes/        # API路由
          services/      # 业务逻辑
          middleware/    # 中间件
        tests/

      frontend/
        src/
          components/    # UI组件
          pages/         # 页面
          api/           # API调用
          store/         # 状态管理
      ```

      关键实现示例：

      1. 订单创建（处理库存）
      ```python
      def create_order(user_id, items):
          with db.transaction():
              # 检查库存
              for item in items:
                  product = Product.get(item['id'])
                  if product.stock < item['quantity']:
                      raise InsufficientStock()

              # 扣减库存
              for item in items:
                  Product.update_stock(item['id'], -item['quantity'])

              # 创建订单
              order = Order.create(user_id=user_id, items=items)
              return order
      ```

      2. JWT认证中间件
      ```python
      def require_auth(func):
          def wrapper(*args, **kwargs):
              token = request.headers.get('Authorization')
              user = verify_jwt(token)
              if not user:
                  return {'error': 'Unauthorized'}, 401
              return func(user=user, *args, **kwargs)
          return wrapper
      ```

      最佳实践：
      - 使用ORM避免SQL注入
      - 密码加密存储（bcrypt）
      - API版本控制 (/api/v1)
      - 请求日志记录
      - 错误统一处理

      常见陷阱：
      ⚠ 库存扣减不加锁（并发问题）
      ⚠ 订单金额前端计算（不可信）
      ⚠ 忘记添加索引（性能问题）
      ⚠ 跨域配置缺失（CORS）

      ----------------------------------------
      阶段总结：提供了核心实现框架和关键代码示例。
      ========================================

      ✅ 5阶段开发流程规划完成！
      建议按计划逐步实现，优先完成P0功能。

# Skill配置
skill_config:
  retry_on_error: false
  timeout: 180
  parse_output: false
