---
description: BMAD Iteration Phase 1 - Analyze PRD changes between baseline and new requirements, generate diff report and change inventory
argument-hint: [new-prd-path]
allowed-tools: Read, Write, Edit, Grep, Glob, Task
model: claude-opus-4-5-20251022
---

# BMAD Iteration Phase 1: PRD Diff Analysis

You are initiating **Phase 1 of the BMAD Iteration workflow** - PRD Diff Analysis. Your role is to analyze changes between the baseline PRD and new requirements, categorize changes, and create a comprehensive change inventory.

## Context

**New PRD Path** (optional): $ARGUMENTS

**Baseline Documents**:
@docs/bmad/02-planning/prd.md
@docs/bmad/02-planning/user-stories.md

**Current Iteration State**:
- Iteration ID: !`cat .bmad-iter/state.yaml 2>/dev/null | grep "id:" | head -1`
- Baseline version: !`cat .bmad-iter/state.yaml 2>/dev/null | grep "last_release:" | head -1`

## Your Mission

As the **Diff Analyst Agent**, compare the baseline PRD with new requirements and produce a comprehensive change analysis.

### Step 1: Load Baseline

Read and understand the current baseline:

1. **Current PRD Structure**
   - Feature sections
   - User stories
   - Acceptance criteria
   - Technical constraints

2. **Current Implementation State**
   - What's already built
   - Current architecture
   - Existing APIs

### Step 2: Identify Changes

Compare with new requirements and categorize:

**Change Types:**
- `ADD` - New feature/capability not in baseline
- `MODIFY` - Change to existing feature behavior
- `ENHANCE` - Improvement to existing feature (non-breaking)
- `DEPRECATE` - Feature to be removed/replaced
- `FIX` - Bug fix or defect correction

**For each change, identify:**
- Affected PRD section
- Change description
- User impact
- Technical complexity (S/M/L/XL)
- Dependencies on other changes

### Step 3: Generate Diff Report

Create comprehensive analysis:

#### Artifact 1: `docs/bmad-iter/[iter-id]/01-diff/diff-report.md`

```markdown
# PRD Diff Analysis Report

## Document Info
- **Iteration**: [iter-id]
- **Date**: [Current Date]
- **Baseline PRD Version**: [version]
- **Analyst**: BMAD Diff Analyst Agent

---

## Executive Summary

**Total Changes Identified**: [count]
- Additions: [count]
- Modifications: [count]
- Enhancements: [count]
- Deprecations: [count]
- Fixes: [count]

**Estimated Effort**: [S/M/L/XL]
**Risk Level**: [Low/Medium/High]

---

## Change Analysis

### Section: [PRD Section Name]

#### Change 1: [Title]
- **Type**: ADD | MODIFY | ENHANCE | DEPRECATE | FIX
- **Description**: [What is changing]
- **Current State**: [How it works now]
- **Target State**: [How it should work]
- **User Impact**: [Who is affected and how]
- **Complexity**: S | M | L | XL
- **Dependencies**: [Other changes this depends on]

**Diff:**
```diff
- [Old requirement text]
+ [New requirement text]
```

#### Change 2: [Title]
[Same structure]

---

### Section: [Another PRD Section]
[Continue for all sections with changes]

---

## Dependency Graph

```
CHG-001 ──→ CHG-002
    │
    └──→ CHG-003 ──→ CHG-004
```

---

## Risk Assessment

### High Risk Changes
| Change | Risk | Mitigation |
|--------|------|------------|
| [ID] | [Description] | [Mitigation strategy] |

### Technical Debt Implications
- [Any technical debt being addressed or introduced]

---

## Recommendations

1. **Must Include in Iteration**
   - [Change ID]: [Reason]

2. **Should Include if Time Permits**
   - [Change ID]: [Reason]

3. **Defer to Future Iteration**
   - [Change ID]: [Reason]

---

Generated by BMAD Iteration Workflow - Phase 1: Diff Analysis
```

#### Artifact 2: `docs/bmad-iter/[iter-id]/01-diff/change-list.md`

```markdown
# Change Inventory

## Quick Reference

| ID | Type | Title | Section | Complexity | Priority | Status |
|----|------|-------|---------|------------|----------|--------|
| CHG-001 | ADD | [Title] | [Section] | M | P1 | New |
| CHG-002 | MODIFY | [Title] | [Section] | L | P1 | New |
| CHG-003 | ENHANCE | [Title] | [Section] | S | P2 | New |

---

## Detailed Changes

### CHG-001: [Title]

**Type**: ADD
**Section**: [PRD Section]
**Priority**: P1 (Must Have) | P2 (Should Have) | P3 (Nice to Have)
**Complexity**: S (1-2 days) | M (3-5 days) | L (1-2 weeks) | XL (2+ weeks)

**Description**:
[Detailed description of what needs to be added]

**Acceptance Criteria**:
- [ ] [Criterion 1]
- [ ] [Criterion 2]
- [ ] [Criterion 3]

**Dependencies**:
- Depends on: [CHG-xxx]
- Blocks: [CHG-xxx]

**Technical Notes**:
- [Implementation hints]
- [Potential challenges]

---

### CHG-002: [Title]
[Same structure]

---

## Statistics

- **Total Changes**: [count]
- **By Type**: ADD([n]), MODIFY([n]), ENHANCE([n]), DEPRECATE([n]), FIX([n])
- **By Priority**: P1([n]), P2([n]), P3([n])
- **By Complexity**: S([n]), M([n]), L([n]), XL([n])
- **Estimated Total Effort**: [days/weeks]

---

Generated by BMAD Iteration Workflow - Phase 1: Diff Analysis
```

## Output Requirements

### Artifact Locations

```
docs/bmad-iter/[iter-id]/01-diff/
├── diff-report.md          # Comprehensive diff analysis
└── change-list.md          # Change inventory
```

### Steps

1. **Create directory structure**
   ```bash
   mkdir -p docs/bmad-iter/[iter-id]/01-diff
   ```

2. **Read baseline PRD**
   - `docs/bmad/02-planning/prd.md`

3. **Get new requirements**
   - From $ARGUMENTS path, or
   - Prompt user for changes

4. **Generate analysis**
   - `docs/bmad-iter/[iter-id]/01-diff/diff-report.md`
   - `docs/bmad-iter/[iter-id]/01-diff/change-list.md`

5. **Update state**
   ```yaml
   # .bmad-iter/state.yaml
   workflow:
     current_phase: 1
     phase_status:
       1: completed
   changes:
     total: [count]
   ```

6. **Commit to git**
   ```bash
   git add docs/bmad-iter/[iter-id]/01-diff/
   git commit -m "feat(bmad-iter): Phase 1 - PRD diff analysis complete"
   ```

## Success Criteria

- [ ] Baseline PRD read and understood
- [ ] All changes identified and categorized
- [ ] Each change has type, complexity, and priority
- [ ] Dependencies between changes mapped
- [ ] Risk assessment completed
- [ ] Both artifacts created
- [ ] State updated
- [ ] Changes committed to git

## Next Phase

After completing this phase, run:
```
/bmad-iter-plan
```

Or use the orchestrator:
```
/bmad-iter next
```

This will initiate Phase 2: Iteration Planning.

---

**IMPORTANT**:
- Be thorough - missed changes cause scope creep later
- Be accurate with complexity estimates
- Identify ALL dependencies between changes
- Flag high-risk changes prominently
