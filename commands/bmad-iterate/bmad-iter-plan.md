---
description: BMAD Iteration Phase 2 - Plan iteration scope, prioritize changes, and create iteration stories from diff analysis
argument-hint: [iteration-type]
allowed-tools: Read, Write, Edit, Grep, Glob, Task
model: claude-opus-4-5-20251022
---

# BMAD Iteration Phase 2: Iteration Planning

You are initiating **Phase 2 of the BMAD Iteration workflow** - Iteration Planning. Your role is to transform the diff analysis into a prioritized iteration plan with actionable stories.

## Context

**Iteration Type** (optional): $ARGUMENTS
- `sprint` - 1-2 week iteration with multiple stories
- `quick` - 1-3 day quick iteration
- `continuous` - Single story continuous delivery

**Previous Phase Artifacts**:
@docs/bmad-iter/[iter-id]/01-diff/diff-report.md
@docs/bmad-iter/[iter-id]/01-diff/change-list.md

**Current Iteration State**:
- Iteration: !`cat .bmad-iter/state.yaml 2>/dev/null | grep -A5 "current_iteration:"`

## Your Mission

As the **Iteration Planner Agent**, create a focused iteration plan that balances scope, time, and risk.

### Step 1: Analyze Changes

Review the diff analysis:

1. **Change Inventory**
   - Total changes identified
   - Priority distribution (P1/P2/P3)
   - Complexity distribution (S/M/L/XL)
   - Dependencies

2. **Constraints**
   - Available time
   - Team capacity (solo developer)
   - Technical dependencies
   - Risk tolerance

### Step 2: Scope the Iteration

Based on iteration type, define scope:

**Sprint (1-2 weeks)**:
- Include all P1 changes
- Include P2 changes if capacity allows
- Defer P3 to future iterations
- Target: 5-10 stories

**Quick (1-3 days)**:
- Focus on 1-3 highest priority changes
- Skip non-essential changes
- Minimize scope creep
- Target: 1-3 stories

**Continuous**:
- Single change per iteration
- Immediate release after completion
- Requires feature flags
- Target: 1 story

### Step 3: Create Stories

Transform changes into development stories:

**Story Structure**:
```markdown
## STORY-XXX: [Title]

**Change Reference**: CHG-XXX
**Type**: ADD | MODIFY | ENHANCE | DEPRECATE | FIX
**Priority**: P1 | P2 | P3
**Complexity**: S | M | L

### User Story
As a [user type]
I want [capability]
So that [benefit]

### Acceptance Criteria
- [ ] Given [context], when [action], then [result]
- [ ] [Additional criteria]

### Technical Approach
- [High-level implementation approach]
- [Key files to modify]
- [APIs to change]

### Dependencies
- Requires: STORY-XXX
- Blocks: STORY-XXX

### Estimated Effort
- Development: [hours/days]
- Testing: [hours/days]
- Total: [hours/days]
```

### Step 4: Generate Iteration Plan

#### Artifact 1: `docs/bmad-iter/[iter-id]/02-plan/iteration-plan.md`

```markdown
# Iteration Plan

## Iteration Info
- **ID**: [iter-id]
- **Name**: [iteration name]
- **Type**: sprint | quick | continuous
- **Start Date**: [date]
- **Target Date**: [date]
- **Duration**: [days/weeks]

---

## Scope Summary

### In Scope
| Change | Type | Priority | Story |
|--------|------|----------|-------|
| CHG-001 | ADD | P1 | STORY-001 |
| CHG-002 | MODIFY | P1 | STORY-002 |

### Out of Scope (Deferred)
| Change | Type | Reason |
|--------|------|--------|
| CHG-005 | ENHANCE | Low priority, defer to next iteration |

---

## Goals

### Primary Goals
1. [Goal 1 - tied to specific changes]
2. [Goal 2]

### Success Metrics
- [ ] All P1 changes implemented
- [ ] Test coverage maintained at [X]%
- [ ] No regression in existing features
- [ ] Release deployed to [environment]

---

## Timeline

### Sprint Plan
| Day | Focus | Stories |
|-----|-------|---------|
| 1-2 | Story 1 | STORY-001 |
| 3-5 | Story 2 | STORY-002 |
| 6-8 | Story 3 | STORY-003 |
| 9 | Testing | Regression |
| 10 | Release | Deploy |

### Milestones
- [ ] Day 5: Core changes complete
- [ ] Day 8: All development complete
- [ ] Day 9: Testing complete
- [ ] Day 10: Released

---

## Risk Mitigation

### Identified Risks
| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| [Risk] | High/Med/Low | High/Med/Low | [Strategy] |

### Contingency Plans
- If behind schedule: [action]
- If blocker found: [action]

---

## Dependencies

### External Dependencies
- [Any external services/APIs]

### Internal Dependencies
```
STORY-001 ──→ STORY-002
    │
    └──→ STORY-003
```

---

## Exit Criteria

### Definition of Done (Iteration)
- [ ] All in-scope stories completed
- [ ] All tests passing
- [ ] Regression tests passed
- [ ] Release notes prepared
- [ ] Deployed to [environment]
- [ ] Stakeholders notified

---

Generated by BMAD Iteration Workflow - Phase 2: Planning
```

#### Artifact 2: `docs/bmad-iter/[iter-id]/02-plan/iter-stories.md`

```markdown
# Iteration Stories

## Story Overview

| ID | Title | Type | Priority | Complexity | Status |
|----|-------|------|----------|------------|--------|
| STORY-001 | [Title] | ADD | P1 | M | Pending |
| STORY-002 | [Title] | MODIFY | P1 | L | Pending |
| STORY-003 | [Title] | ENHANCE | P2 | S | Pending |

---

## STORY-001: [Title]

### Story Info
- **Change Reference**: CHG-001
- **Type**: ADD
- **Priority**: P1 (Must Have)
- **Complexity**: M (3-5 days)
- **Status**: Pending

### User Story

**As a** [user type]
**I want** [capability/action]
**So that** [benefit/value]

### Acceptance Criteria

- [ ] **AC1**: Given [context], when [action], then [expected result]
- [ ] **AC2**: Given [context], when [action], then [expected result]
- [ ] **AC3**: [Edge case or error scenario]
- [ ] **AC4**: [Performance or security requirement]

### Technical Approach

**Files to Create**:
| Path | Purpose |
|------|---------|
| src/components/[name].tsx | [Description] |
| src/lib/[name].ts | [Description] |

**Files to Modify**:
| Path | Changes |
|------|---------|
| src/app/[path]/page.tsx | [What changes] |
| src/lib/api/[name].ts | [What changes] |

**API Changes**:
| Method | Endpoint | Change |
|--------|----------|--------|
| POST | /api/[path] | New endpoint |
| PUT | /api/[path] | Modified request body |

**Database Changes**:
```sql
-- If applicable
ALTER TABLE [table] ADD COLUMN [column] [type];
```

### Dependencies

- **Requires**: None | STORY-XXX (must complete first)
- **Blocks**: STORY-XXX, STORY-YYY

### Testing Requirements

- [ ] Unit tests for new components
- [ ] Integration tests for API changes
- [ ] E2E test for user flow
- [ ] Regression test for affected areas

### Estimated Effort

| Activity | Estimate |
|----------|----------|
| Development | 2 days |
| Testing | 0.5 days |
| Review | 0.5 days |
| **Total** | **3 days** |

---

## STORY-002: [Title]

[Same structure as STORY-001]

---

## STORY-003: [Title]

[Same structure as STORY-001]

---

## Story Dependencies

```
STORY-001 (Day 1-2)
    │
    ├──→ STORY-002 (Day 3-5)
    │        │
    │        └──→ STORY-004 (Day 6-7)
    │
    └──→ STORY-003 (Day 3-4)
```

---

## Total Estimates

| Metric | Value |
|--------|-------|
| Total Stories | [count] |
| Total Dev Days | [days] |
| Total Test Days | [days] |
| Buffer | [days] |
| **Iteration Duration** | **[days]** |

---

Generated by BMAD Iteration Workflow - Phase 2: Planning
```

## Output Requirements

### Artifact Locations

```
docs/bmad-iter/[iter-id]/02-plan/
├── iteration-plan.md       # Iteration plan
└── iter-stories.md         # Detailed stories
```

### Steps

1. **Read Phase 1 artifacts**
   - diff-report.md
   - change-list.md

2. **Determine iteration type**
   - From $ARGUMENTS or prompt user

3. **Generate plan and stories**
   - iteration-plan.md
   - iter-stories.md

4. **Update state**
   ```yaml
   # .bmad-iter/state.yaml
   workflow:
     current_phase: 2
     phase_status:
       1: completed
       2: completed
   changes:
     stories:
       - id: story-001
         type: ADD
         title: "[Title]"
         status: pending
   ```

5. **Commit to git**
   ```bash
   git add docs/bmad-iter/[iter-id]/02-plan/
   git commit -m "feat(bmad-iter): Phase 2 - Iteration plan complete"
   ```

## Success Criteria

- [ ] All in-scope changes have stories
- [ ] Stories have complete acceptance criteria
- [ ] Dependencies mapped correctly
- [ ] Timeline is realistic
- [ ] Risks identified with mitigation
- [ ] Exit criteria defined
- [ ] Both artifacts created
- [ ] State updated

## Next Phase

After completing this phase, run:
```
/bmad-iter-impact
```

Or:
```
/bmad-iter next
```

This will initiate Phase 3: Impact Analysis.

---

**IMPORTANT**:
- Be realistic with estimates (add buffer)
- Don't overcommit - better to underpromise
- Ensure stories are independent when possible
- Flag any blockers immediately
