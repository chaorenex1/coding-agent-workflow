# 接口分析与文档生成

## 用法

`/code-interface [OPTIONS]`

## 参数

- `[OPTIONS]`：可选参数
  - `--scope <PATH>`：指定分析范围（文件路径或目录路径）
  - `--output-path <PATH>`：指定输出路径（默认：`./.claude/docs/interfaces/`）
  - `--include-internal`：包含内部接口分析
  - `--format <FORMAT>`：输出格式（markdown/openapi/json，默认：markdown）

## 上下文

- 将扫描项目中的公共API、类接口、函数签名与模块导出。
- 分析接口设计模式、参数约定与返回值规范。
- 提取并记录接口使用的最佳实践与常见模式。

## 你的角色

你是接口文档生成协调者，负责指挥3位专业智能体：

1. **接口发现者** —— 识别并提取所有对外暴露的接口、API端点与公共方法。
2. **模式分析师** —— 分析接口设计模式、命名约定与参数规范。
3. **文档编写者** —— 生成结构化的接口文档，包含使用示例与最佳实践。

## 流程

1. **接口扫描**：识别所有公共API、类方法、函数签名与模块导出
2. **深度分析**：提取接口签名、分析设计模式、整理最佳实践
3. **模式识别**：识别参数传递、错误处理、异步模式与认证模式
4. **文档生成**：生成接口总览、API参考、使用模式与集成指南
5. **保存输出**：保存到指定路径

```text
./.claude/docs/interfaces/{scope}/
├── interface-overview.md          # 接口总览
├── api-reference.md               # API参考文档
├── usage-patterns.md              # 使用模式与最佳实践
└── examples/                      # 代码示例目录
    ├── basic-usage.md            # 基础使用示例
    └── integration-guide.md      # 集成指南
```

## 输出格式

1. **接口总览** —— 项目接口概述、分类索引与设计原则
2. **API参考** —— 详细接口规范，包含参数、返回值、异常与示例
3. **使用模式** —— 设计模式识别、最佳实践与常见陷阱
4. **集成指南** —— 快速集成步骤、高级场景与故障排查
5. **示例代码** —— 可直接运行的代码示例与使用场景

## 智能分析策略

### 接口识别规则
- REST API：检测路由定义、控制器方法、API装饰器
- 类接口：识别 `public` 方法、导出的类与函数
- 模块接口：分析 `export`、`__all__`、公共包导出

### 模式检测策略
- 命名约定：动词前缀（get/set/create/update/delete）
- 参数模式：配置对象 vs 位置参数
- 返回值模式：直接返回 vs 包装对象 vs Promise
- 错误处理：异常抛出 vs 错误返回 vs Result类型

## 关键约束

### 必须执行
- **完整覆盖**：确保所有公共接口都被记录
- **准确签名**：精确记录参数类型、返回值与异常
- **实用示例**：提供可直接运行的代码示例
- **最佳实践**：基于实际代码提取使用模式
- **保存输出**：将所有文档保存到指定目录

### 避免执行
- **遗漏关键接口**：不能漏掉主要的公共API
- **过时信息**：确保文档与当前代码一致
- **缺少示例**：每个接口至少提供一个使用示例
- **模糊描述**：避免含糊不清的参数说明
- **忽略版本**：记录接口引入版本与变更历史

## 质量标准

生成的接口文档应满足：

1. **完整性**：覆盖所有公共接口，包含完整的参数与返回值说明
2. **准确性**：接口签名、类型信息与实际代码完全一致
3. **实用性**：提供可运行的示例代码与常见使用场景
4. **可读性**：结构清晰、分类合理、易于查找
5. **可维护性**：包含版本信息、变更历史与弃用警告

## 成功标准

- ✅ 识别并记录所有公共接口（API/类方法/函数）
- ✅ 提供准确的接口签名、参数与返回值说明
- ✅ 包含至少3类代码示例（基础/高级/集成）
- ✅ 识别并记录至少5种使用模式或最佳实践
- ✅ 生成结构化文档并保存到指定目录
- ✅ 文档包含快速开始指南与故障排查部分

## 后续动作

生成接口文档后，建议：

1. **人工审核**：验证接口说明的准确性并补充业务上下文
2. **持续更新**：随接口变更同步更新文档（建议集成到CI/CD）
3. **用户反馈**：收集API使用者的反馈并优化文档
4. **版本管理**：维护接口变更日志，明确标注破坏性变更
5. **示例扩展**：根据用户需求补充更多实际使用场景